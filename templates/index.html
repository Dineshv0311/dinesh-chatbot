<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat with Dinesh AI 🤖</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <h1>Chat with Dinesh AI 🤖</h1>
    <div id="chat"></div>
    <div class="input-area">
      <input id="user" type="text" placeholder="Type your message..." onkeydown="if(event.key==='Enter')sendMessage()">
      <button onclick="sendMessage()">Send</button>
    </div>
    <div style="margin-top: 15px; text-align: center;">
      <button onclick="toggleDarkMode()">🌙 Toggle Dark Mode</button>
      <a href="/view-log" target="_blank"><button>📄 View Chat Log</button></a>
      <a href="/download-log"><button>⬇️ Download Log</button></a>
      <a href="/view-db" target="_blank"><button>🗃 View DB Log</button></a>
    </div>
  </div>

  <script>
    async function sendMessage() {
      const input = document.getElementById("user");
      const userMessage = input.value.trim();
      if (!userMessage) return;

      const chatBox = document.getElementById("chat");
      chatBox.innerHTML += `
        <div class="message user">
          <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" class="avatar">
          <div class="bubble user-bubble">${userMessage}</div>
        </div>`;
      input.value = "";

      try {
        const response = await fetch("/chat", {
          method: "POST",
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: userMessage })
        });
        const data = await response.json();
        chatBox.innerHTML += `
          <div class="message bot">
            <img src="https://cdn-icons-png.flaticon.com/512/4712/4712034.png" class="avatar">
            <div class="bubble bot-bubble">${data.reply}</div>
          </div>`;
      } catch (err) {
        chatBox.innerHTML += `
          <div class="message bot">
            <img src="https://cdn-icons-png.flaticon.com/512/4712/4712034.png" class="avatar">
            <div class="bubble bot-bubble">⚠️ Error talking to local AI model.</div>
          </div>`;
      }

      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function toggleDarkMode() {
      document.body.classList.toggle('dark');
    }
  </script>
</body>
</html>
